<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background-color: #f4f4f4;
            height: 100vh;
        }
        iframe {
            width: 100%;
            max-width: 800px;
            height: 90%;
            border: 1px solid #ddd;
            margin: 0 auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@pipedrive/app-extensions-sdk@0/dist/index.umd.js"></script>
</head>
<body>
<iframe src="form.html"></iframe>

<script>
    (async function() {
        // Инициализация SDK
        const sdk = await new AppExtensionsSDK().initialize();
        console.log('Pipedrive SDK initialized');

        window.addEventListener('message', async (event) => {
            console.log('Received message from iframe:', event.data);

            // Отправка данных на сервер
            fetch('http://localhost:3001/api/create-deal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(event.data),
            })
                .then(response => response.json())
                .then(result => {
                    console.log('Deal created?:', result);
                })
                .catch(error => {
                    console.error('Error:', error);
                });

            // Открытие модального окна с данными из формы
            sdk.execute(AppExtensionsSDK.Command.OPEN_MODAL, {
                type: AppExtensionsSDK.Modal.CUSTOM_MODAL,
                action_id: 'bea60497-8b43-48d5-8c9e-178ec2ede78f',
                data: event.data,

            })
                .then(({ status }) => {
                    console.log('Modal status:', status);

                    // Изменение размера модального окна после его открытия
                /*    return sdk.execute(AppExtensionsSDK.Command.RESIZE, {
                        height: 600,
                        width: 800
                    });*/
                    return sdk.execute(Command.RESIZE, { height: 600, width: 800 });
                })
                .then(() => {
                    console.log('Modal resized to height: 600px, width: 800px');
                })
                .catch(error => {
                    console.error('Error handling modal or resizing:', error);
                });
        });
    })();
</script>
</body>
</html>
